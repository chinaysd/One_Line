C51 COMPILER V9.59.0.0   BSP_ONELINE                                                       04/01/2019 20:55:27 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE BSP_ONELINE
OBJECT MODULE PLACED IN .\Objects\bsp_oneline.obj
COMPILER INVOKED BY: E:\MDK\C51\BIN\C51.EXE ..\bsp\bsp_oneline.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\bsp;..\lib;..\user) 
                    -DEBUG OBJECTEXTEND PRINT(.\Listings\bsp_oneline.lst) TABS(7) OBJECT(.\Objects\bsp_oneline.obj)

line level    source

   1          #include "bsp_oneline.h"
   2          
   3          PROTOCOL_SENDMODE Protocol_SendMode;
   4          
   5          PROTOCOL_REVMODE  Protocol_RevMode;
   6          
   7          
   8          /**********************************************************************************
   9          *作者:peter
  10          *日期:190401
  11          *描述:IO口输出初始化
  12          *返回:无
  13          ***********************************************************************************/
  14          void OneLineOut_Init(void)
  15          {
  16   1             P0CON |= 0X01;
  17   1             P0PH   &= ~0X01;
  18   1      }
  19          /**********************************************************************************
  20          *作者:peter
  21          *日期:190401
  22          *描述:IO口输入初始化
  23          *返回:无
  24          ***********************************************************************************/
  25          void OneLineIn_Init(void)
  26          {
  27   1             P0CON &= ~0X01;
  28   1             P0PH   |=  0X01;
  29   1      }
  30          
  31          /**********************************************************************************
  32          *作者:peter
  33          *日期:190401
  34          *描述:数据1处理
  35          *返回:无
  36          ***********************************************************************************/
  37          static void Data1_Handle(void)
  38          {
  39   1             Protocol_SendMode.u16Send1Cnts ++;
  40   1             if(Protocol_SendMode.u16Send1Cnts < Data1Time9Cnts)
  41   1             {
  42   2                    WriteHight();
  43   2             }
  44   1             else
  45   1             {
  46   2                    if(Protocol_SendMode.u16Send1Cnts < Data1Time10Cnts)
  47   2                    {
  48   3                           WriteLow();
  49   3                    }
  50   2                    else
  51   2                    {
  52   3                           Protocol_SendMode.u16Send1Cnts = 0;
  53   3                           Protocol_SendMode.CommandTemp <<= 1;
  54   3                           Protocol_SendMode.index --;
C51 COMPILER V9.59.0.0   BSP_ONELINE                                                       04/01/2019 20:55:27 PAGE 2   

  55   3                    }
  56   2             }
  57   1      }
  58          /**********************************************************************************
  59          *作者:peter
  60          *日期:190401
  61          *描述:数据0处理
  62          *返回:无
  63          ***********************************************************************************/
  64          static void Data0_Handle(void)
  65          {
  66   1             Protocol_SendMode.u16Send0Cnts ++;
  67   1             if(Protocol_SendMode.u16Send0Cnts < Data0Time5Cnts)
  68   1             {
  69   2                    WriteHight();
  70   2             }
  71   1             else
  72   1             {
  73   2                    if(Protocol_SendMode.u16Send0Cnts < Data0Time10Cnts)
  74   2                    {
  75   3                           WriteLow();
  76   3                    }
  77   2                    else
  78   2                    {
  79   3                           Protocol_SendMode.u16Send0Cnts = 0;
  80   3                           Protocol_SendMode.CommandTemp <<= 1;
  81   3                           Protocol_SendMode.index --;
  82   3                    }
  83   2             }
  84   1      }
  85          /**********************************************************************************
  86          *作者:peter
  87          *日期:190401
  88          *描述:数据处理
  89          *返回:无
  90          ***********************************************************************************/
  91          static void Data_Handle(void)
  92          {
  93   1             if(Protocol_SendMode.ProcessFlag)
  94   1             {
  95   2                    Protocol_SendMode.u16SendHanderCnts ++;
  96   2                    if(Protocol_SendMode.u16SendHanderCnts < HeadDataTime)
  97   2                    {
  98   3                           WriteLow();
  99   3                    }
 100   2                    else
 101   2                   {
 102   3                                  if(Protocol_SendMode.index > 0)
 103   3                                  {
 104   4                                         if(Protocol_SendMode.CommandTemp & 0x80)
 105   4                                         {
 106   5                                                Data1_Handle();
 107   5                                         }
 108   4                                         else
 109   4                                         {
 110   5                                                Data0_Handle();
 111   5                                         }
 112   4                                  }
 113   3                                  else
 114   3                                  {
 115   4                                         Protocol_SendMode.u16SendEnderCnts ++;
 116   4                                         WriteLow();
C51 COMPILER V9.59.0.0   BSP_ONELINE                                                       04/01/2019 20:55:27 PAGE 3   

 117   4                                         if(Protocol_SendMode.u16SendEnderCnts == EndDataTime)
 118   4                                         {
 119   5                                                WriteHight();
 120   5                                                Protocol_SendMode.u16SendEnderCnts = 0;
 121   5                                                Protocol_SendMode.u16SendHanderCnts = 0;
 122   5                                                Protocol_SendMode.ProcessFlag = 0;
 123   5                                                Protocol_SendMode.index = 8;
 124   5                                         }
 125   4                                  }
 126   3                    }
 127   2             }
 128   1      }
 129          /**********************************************************************************
 130          *作者:peter
 131          *日期:190401
 132          *描述:一串数据发送处理
 133          *返回:无
 134          ***********************************************************************************/
 135          void OneLineOut_Handle(void)
 136          {
 137   1             Protocol_SendMode.u16SenderCnts ++;
 138   1             if(Protocol_SendMode.u16SenderCnts == SerialDataTime)
 139   1             {
 140   2                    Protocol_SendMode.u16SenderCnts = 0;
 141   2                    Protocol_SendMode.ProcessFlag = 1;
 142   2                    Protocol_SendMode.CommandTemp = Protocol_SendMode.Command;
 143   2             }
 144   1             Data_Handle();
 145   1      }
 146          
 147          /**********************************************************************************
 148          *作者:peter
 149          *日期:190401
 150          *描述:一串数据接收处理
 151          *返回:无
 152          ***********************************************************************************/
 153          void OneLineIn_Handle(void)
 154          {
 155   1             Protocol_RevMode.Rev_Data = ONELINE_PIN;
 156   1             if((!Protocol_RevMode.Rev_Data)&&(!Protocol_RevMode.StartRevDataFlag))
 157   1             {
 158   2                    ++ Protocol_RevMode.u8Cnts50ms;
 159   2             }
 160   1             if(Protocol_RevMode.Rev_Data)
 161   1             {
 162   2                    if((Protocol_RevMode.u8Cnts50ms >= 15)&&(Protocol_RevMode.u8Cnts50ms <= 22))
 163   2                    {
 164   3                           Protocol_RevMode.HightLevelTime = 0;
 165   3                           Protocol_RevMode.LowLevelTime = 0;
 166   3                           Protocol_RevMode.u8Cnts50ms= 0;
 167   3                           Protocol_RevMode.Value = 0;
 168   3                           Protocol_RevMode.StartRevDataFlag = 1;
 169   3                           Protocol_RevMode.Total_Data = 8;
 170   3                    }
 171   2                    else if(Protocol_RevMode.u8Cnts50ms > 22)
 172   2                    {
 173   3                           Protocol_RevMode.HightLevelTime = 0;
 174   3                           Protocol_RevMode.LowLevelTime = 0;
 175   3                           Protocol_RevMode.u8Cnts50ms= 0;
 176   3                           Protocol_RevMode.Value = 0;
 177   3                           Protocol_RevMode.StartRevDataFlag = 0;
 178   3                           Protocol_RevMode.Total_Data = 8;
C51 COMPILER V9.59.0.0   BSP_ONELINE                                                       04/01/2019 20:55:27 PAGE 4   

 179   3                    }
 180   2                    else
 181   2                    {
 182   3                           Protocol_RevMode.u8Cnts50ms = 0;
 183   3                    }
 184   2             }
 185   1             if(Protocol_RevMode.StartRevDataFlag)
 186   1             {
 187   2                    if(Protocol_RevMode.Total_Data > 0)
 188   2                    {
 189   3                           if(Protocol_RevMode.Rev_Data)
 190   3                           {
 191   4                                  Protocol_RevMode.LowLevelFlag = 1;
 192   4                                  Protocol_RevMode.HightLevelTime ++;
 193   4                           }
 194   3                           if((!Protocol_RevMode.Rev_Data)&&(Protocol_RevMode.LowLevelFlag))
 195   3                           {
 196   4                                  Protocol_RevMode.LowLevelFlag = 0;
 197   4                                  Protocol_RevMode.Value <<= 1;
 198   4                                  Protocol_RevMode.LowLevelTime ++;
 199   4                                  if((Protocol_RevMode.HightLevelTime >= 7)&&(Protocol_RevMode.HightLevelTime <= 10))
 200   4                                  {
 201   5                                         Protocol_RevMode.HightLevelTime = 0;
 202   5                                         Protocol_RevMode.LowLevelTime = 0;
 203   5                                         Protocol_RevMode.Value |= 0x01;
 204   5                                         Protocol_RevMode.Total_Data --;
 205   5                                  }
 206   4                                  if((Protocol_RevMode.HightLevelTime >= 1)&&(Protocol_RevMode.HightLevelTime <= 6))
 207   4                                  {
 208   5                                         Protocol_RevMode.HightLevelTime = 0;
 209   5                                         Protocol_RevMode.LowLevelTime = 0;
 210   5                                         Protocol_RevMode.Value &= ~0x01;
 211   5                                         Protocol_RevMode.Total_Data --;
 212   5                                  }
 213   4                                  if((Protocol_RevMode.HightLevelTime > 16)&&(Protocol_RevMode.LowLevelTime>8))
 214   4                                  {
 215   5                                         Protocol_RevMode.HightLevelTime = 0;
 216   5                                         Protocol_RevMode.LowLevelTime = 0;
 217   5                                         Protocol_RevMode.u8Cnts50ms= 0;
 218   5                                         Protocol_RevMode.Value = 0;
 219   5                                         Protocol_RevMode.StartRevDataFlag = 0;
 220   5                                         Protocol_RevMode.Total_Data = 8;
 221   5                                  }
 222   4                           }
 223   3                    }
 224   2                    else
 225   2                    {
 226   3                           Protocol_RevMode.HightLevelTime = 0;
 227   3                           Protocol_RevMode.LowLevelTime = 0;
 228   3                           Protocol_RevMode.u8Cnts50ms= 0;
 229   3                           Protocol_RevMode.Data = Protocol_RevMode.Value;
 230   3                           Protocol_RevMode.StartRevDataFlag = 0;
 231   3                           Protocol_RevMode.Total_Data = 8;
 232   3                    }
 233   2             }
 234   1             
 235   1      }
 236          
 237          
 238          
 239          
 240          
C51 COMPILER V9.59.0.0   BSP_ONELINE                                                       04/01/2019 20:55:27 PAGE 5   

 241          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    518    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     26    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
